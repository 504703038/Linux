### 实验1

#### 实验1-1

~~~sql
create table test1_student(
sid char(12) not null,
name varchar(10) not null,
sex char(2) not null
age int,
birthday date,
dname varchar(30),
class varchar(10))
~~~

#### 实验1-2

```sql
create table test1_course(
cid char(6) not null,
name varchar(40) not null,
fcid char(6),
credit numeric(4,1))
```

#### 实验1-3

```sql
create table test1_student_course(
sid char(12) not null,
cid char(6) not null,
score numeric(5,1),
tid char(6))
```

#### 实验1-4

```sql
insert into test1_student values(200800020101,'王欣','女',19,date'1994-02-02','计算机学院','2010')
insert into test1_student values(200800020102,'李华','女',20,date'1995-03-03','软件学院','2009')
```

#### 实验1-5

```sql
insert into test1_course values(300001,'数据结构',null,2)
insert into test1_course values(300002,'数据库',300001,2.5)
```

#### 实验1-6

```sql
insert into test1_student_course values(200800020101,300001,91.5,100101)
insert into test1_student_course values(200800020101,300002,92.6,100102)
```

### 实验2

#### 实验2-1

```sql
create or replace view test2_01 as
select sid,name
from pub.student
where sid not in (select sid from pub.student_course)
```

#### 实验2-2

```sql
create or replace view test2_02 as
select sid,name
from pub.student
where sid in(
select sid
from pub.student_course
where cid in (select cid from pub.student_course where sid = 200900130417))
```

#### 实验2-3

```sql
create or replace view test2_03 as
select sid,name
from pub.student
where sid in(
select sid
from pub.student_course
where cid in (select cid from pub.course where fcid = 300002)
)
```

#### 实验2-4

```sql
create or replace view test2_04 as
select sid,name
from pub.student
where sid in (select sid from pub.student_course where cid = 300005)
and sid in (select sid from pub.student_course where cid = 300002)
```

#### 实验2-5

```sql
create or replace view test2_05 as
select sid,name,cast(avg(score) as numeric(4,0)) as avg_score,sum(score) sum_score
from (
	select *
	from pub.student natural join pub.student_course
	where age=20)
group by sid,name
```

#### 实验2-6

```sql
create or replace view test2_06 as
with max_score_t as
(select cid,name,max(score)as max_score
from pub.course natural full outer join pub.student_course
group by cid,name)
select cid,name,max_score,max_score2,max_score_count
from(
(select cid,name,max_score,count(distinct sid)as max_score_count
from pub.student_course natural full outer join max_score_t
where score=max_score
group by  cid,name,max_score)
natural full outer join
(select cid,name,max(score)as max_score2
from pub.student_course natural full outer join max_score_t
where score<>max_score
group by cid,name)
)
```

#### 实验2-7

```sql
create or replace view test2_07 as
select sid,name
from pub.student
where name not in(
select name
from pub.student
where name like '李%' 
	or name like '张%'
	or name like '王%')
```

#### 实验2-8

```sql
create or replace view test2_08 as
select substr(name,1,1) as second_name,count(*) as p_count
from pub.student
group by substr(name,1,1)
```

#### 实验2-9

```sql
create or replace view test2_09 as
select sid,name,score
from pub.student natural join pub.student_course
where cid=300003
```

#### 实验2-10

```sql

```



### 实验3

#### 实验3-1

~~~sql
create table test3_01 as
(select *
 from pub.student_31
 where regexp_like(sid,'^[[:digit:]]+$')
)
~~~

#### 实验3-2

~~~sql
create table test3_02 as
(select *
 from pub.student_31
 where age=2012-extract(year from birthday)
)
~~~
#### 实验3-3

~~~sql
create table test3_03 as
(select *
 from pub.student_31
 where sex in('男','女') or sex is null
)
~~~
#### 实验3-4

~~~sql
create table test3_04 as
(select *
 from pub.student_31)

delete 
from test3_04
where dname like '% %' or dname is null or length(dname)<3

~~~
#### 实验3-5

~~~sql
create table test3_05 as
(select *
 from pub.student_31)
 
delete 
from test3_05
where length(class)<>4
~~~
#### 实验3-6

~~~sql
create table test3_06 as
(select *
 from pub.student_31)

delete
from test3_06
where not regexp_like(sid,'^[[:digit:]]+$')
or not age=2012-extract(year from birthday)
or length(name)<2 or name like '% %'
or not (sex in('男','女') or sex is null)
or dname like '% %' or dname is null 
or length(dname)<3
or length(class)<>4
~~~
#### 实验3-7

~~~sql
create table test3_07 as
(select *
 from pub.student_course_32)
 
delete
from test3_07
where sid not in
(select sid
from pub.student)
~~~
#### 实验3-8

~~~sql
create table test3_08 as
(select *
 from pub.student_course_32)
 
delete
from test3_08
where (cid,tid) not in
(select cid,tid from pub.teacher_course)
~~~
#### 实验3-9

~~~sql
create table test3_09 as
(select *
 from pub.student_course_32)
 
delete
from test3_09
where score<0 or score>100
~~~
#### 实验3-10

~~~sql
create table test3_10 as
(select *
 from pub.student_course_32)

delete
from test3_10
where sid not in (select sid from pub.student)
or (cid,tid) not in (select cid,tid from pub.teacher_course)
or score<0 or score>100
or cid not in (select cid from pub.course)
or tid not in (select tid from pub.teacher)
~~~

### 实验4
#### 实验4-1

~~~sql
create table test4_01 as
(select * from pub.student_41)

alter table test4_01
add sum_score int

update test4_01
set sum_score=(
select sum(score)
from pub.student_course
where pub.student_course.sid=test4_01.sid)
~~~
#### 实验4-2

~~~sql
create table test4_02 as
(select * from pub.student_41)

alter table test4_02
add avg_score numeric(12,1)

update test4_02
set avg_score=(
select avg(score)
from pub.student_course
where pub.student_course.sid =test4_02.sid)
~~~
#### 实验4-3

~~~sql
create table test4_03 as
(select * from pub.student_41)

alter table test4_03
add sum_credit int

update test4_03
set sum_credit=(
select sum(credit)
from pub.student_course natural join pub.course 
where sid =test4_03.sid 
and score>=60)
~~~
#### 实验4-4

~~~sql
create table test4_04 as
(select * from pub.student_41)

update test4_04
set dname=(
  select did
  from pub.department
  where pub.department.dname=test4_04.dname
)
where dname in (select dname from pub.department)

/*
update test4_04
set dname=
case
	when test4_04.dname in(select dname from pub.department) then
		(select did
  	from pub.department
  	where pub.department.dname=test4_04.dname)
  else dname
end
*/
~~~
#### 实验4-5

~~~sql

~~~
#### 实验4-6

~~~sql
create table test4_06 as
(select * from pub.student_42)

update test4_06
set name=replace(name,' ','')
~~~
#### 实验4-7

~~~sql
create table test4_07 as
(select * from pub.student_42)

update test4_07
set sex=replace(sex,'性','')

update test4_07
set sex=replace(sex,' ','')
~~~
#### 实验4-8

~~~sql
create table test4_08 as
(select * from pub.student_42)

update test4_08
set class=replace(class,'级','')
~~~
#### 实验4-9

~~~sql
create table test4_09 as
(select * from pub.student_42)

update test4_09
set age=
	2012-extract(year from birthday)
where age is null
~~~
#### 实验4-10

~~~sql
create table test4_10 as
(select * from pub.student_42)

update test4_10
set name=replace(name,' ','')

update test4_10
set dname=replace(dname,' ','')

update test4_10
set sex=replace(sex,'性','')

update test4_10
set sex=replace(sex,' ','')

update test4_10
set class=replace(class,'级','')

update test4_10
set age=
	2012-extract(year from birthday)
where age is null
~~~







### 练习

~~~sql








































~~~





